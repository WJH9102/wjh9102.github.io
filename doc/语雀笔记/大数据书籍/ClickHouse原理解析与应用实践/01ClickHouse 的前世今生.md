# 01ClickHouse 的前世今生

## 1.传统 BI 系统之殇

ERP、CRM 这类 IT 系统在电力、金融多个行业均得以实施。这些应用可以看作线下工作线上化的过程。通常我们把这类联机事务处理系统称为 OLTP 系统。

为了解决数据孤岛的问题，人们提出了数据仓库的概念。即通过引入一个专门用于分析类场景的数据库，将分散的数据统一汇聚到一处。

随着这个概念被进一步完善，一类统一面向数据仓库，专注提供数据分析、决策类功能的系统与解决方案应运而生。最终于 20 世纪 90 年代，有人第一次提出了 BI （商业智能）系统概念。自此以后，人们通常用 BI 一词指代这类分析系统。相对于联机事务处理系统，我们把这类 BI 系统称为联机分析（OLAP）系统。

## 2.现代 BI 系统的新思潮

根据一项调查，互联网用户通常没有耐心。 40% 的用户放弃了加载时间超过 3 秒的网站，页面响应事件每延迟 1 秒就可以是使转化率降低 7% 。实时应答、简单易用，已经是现代互联网系统必备素质。

2003 年起，Google 陆续发表的三篇论文开启了大数据的技术普惠，Hadoop 生态由此开始一发不可收拾，数据分析开启了新纪元。从某种角度来看，以使用 Hadoop 生态位代表的这类非传统关系型数据库技术所实现的 BI 系统，可以称为现代 BI 系统。

## 3.OLAP 常见架构分类

OLAP 名为联机分析，又可以称为多维分析，是由关系型数据库之父埃德加·科德于 1993 年提出的概念。

1. 第一类称为 ROLAP ，它直接使用关系型模型构建，数据模型常使用星型模型或雪花模型。其聚会查询性能较差。
2. 第二类称为 MOLAP，多维型 OLAP 。他的出现是为了缓解 ROLAP 性能问题。MOLAP 使用多维数组的形式保存数据，其核心思想是借助预先聚合结果，使用空间换取事件的形式最终提升查询性能。但维度预处理会导致数据膨胀。
3. 第三类称为 HOLAP，可以理解为 ROLAP 和 MOLAP 两者的集成。

## 4.OLAP 实现技术的演进

- 第一个阶段可以称为传统关系型数据库阶段。这个阶段中，OLAP 主要基于 Oracle 、 MySQL 为代表的一众关系型数据实现。但是不论是 ROLAP 还是 MOLAP ，在数据量大、维度数目多的情况下都存在严重的性能问题，甚至出现根本查询不出结果的情况。
- 第二个阶段可以称为大数据技术阶段。由于大数据处理技术的普及，人们开始使用大数据技术重构 ROLAP 和 MOLAP 。

## 5.ClickHouse 的发展历程

ClickHouse 背后的研发团队是来自俄罗斯的 Yandex 公司。Yandex 是现今世界上最大的俄语搜索引擎。

众所周知，在线搜索引擎的营收来源依赖流量和在线广告业务。所以通常搜索引擎公司为了更好的帮助自身及用户分析网络流量，都会推出自家的在线流量分析产品。

ClickHouse 就是在这样的背景下诞生，伴随着 Yandex.Metrica 业务的发展，最终形成了现在的 ClickHouse。

|**发展历程**|**OLAP 架构**|**Yandex.Metrica 产品形态**|
| --------------------------| --------------------| --------|
|顺理成章的 MySQL 时期|ROLAP|固定报告|
|另辟蹊径的 Metrage 时期|MOLAP|固定报告|
|自我突破的 OLAPServer 时期|HOLAP(ROLAP + MOLAP)|自助报告|
|水到渠成的 ClickHouse 时期|ROLAP|自助报告|

## 6.ClickHouse 不适用的场景

- 不支持事务
- 不擅长根据主键按行粒度进行查询（虽然支持），故不应该把 ClickHouse 当作 Key-Value 数据库使用。
- 不擅长按行删除数据（虽然支持）。
