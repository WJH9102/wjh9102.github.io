# 08MapReduce 的特性

# 1.计数器

计数器是收集作业统计信息的重要手段之一，用于质量控制或应用级统计。计数器还可以辅助诊断系统故障

## 1.1内置计数器

Hadoop 为每个作业维护若干内置计数器，以描述多项指标。

这些计数器被划分为若干组：

- 任务计数器
- 文件系统计数器
- FileInputFormat 计数器
- FileOutputFormat 计数器
- 作业计数器

**任务计数器：**

在任务的执行过程中，任务计数器采集任务的相关信息，每个作业的所有任务的结果会被聚集起来

任务计数器由其关联任务维护，并定期发送给 application master

**作业计数器：**

作业计数器由 application master 维护，因此无需在网络间传输数据，这一点与包括“用户自定义的计数器”在内的其他计数器不同。这些计数器都是作业级别的统计量，其值不会随着任务的运行而改变

## 1.2用户自定义的 Java 计数器

MapReduce 允许用户编写程序来自定义计数器，计数器值可以在 mapper 和 reducer 中增加，计数器由一个 Java 枚举类型来定义，以便对有关的计数器分组。一个作业可以定义的枚举数量不限，各枚举类型所包含的字段数量也不限。枚举类型的名称即为组的名称，枚举类型的字段就是计数器的名称。

**动态计数器：**

动态计数器是一种不由 Java 枚举类型定义的计数器，由于 Java 枚举类型的字段在编译阶段就必须指定，因而无法使用枚举类型动态新建计数器。

**获取计数器：**

获取计数器可以通过 web 界面或者命令行执行`mapred job -counter`还可以通过 Java API 获取计数器的值。

# 2.排序

排序是 MapReduce 的核心技术，尽管应用可能不需要对数据排序，但仍可能使用 MapReduce 的排序功能来组织数据。

## 2.2部分排序

默认情况下，MapReduce 对输入记录的键进行排序

## 2.3全排序

1. 思路就是仿照快速排序的做法，因而关键点在于如何进行分区
2. 通过对键进行采样，可以较为均匀地划分数据集
3. 采样器在客户端运行，因而限制分片地下载量以加速采样器的运行就很重要
4. 常用采样器（采样器的选择基于输入数据的特性）

## 2.4辅助排序

MapReduce 框架在记录到达 reducer 之前按键进行记录排序，但键所对应的值并没有排序。甚至在不同的执行轮次中，这些值的排序也不固定，因为他们来自不同的 map 任务且这些 map 任务在不同轮次中完成的时间也各不相同。

# 3.连接

MapReduce 能够执行大型数据集之间的连接（join）操作，但是，自己从头写相关代码来执行连接操作的确非常棘手。

## 3.1map 端连接

在两个大规模输入数据集之间的 map 端连接会在数据到达 map 函数之前就执行连接操作，为达到该目的，各 map 的输入数据必须先分区并且以特定的方式排序。

map 端连接操作可以连接多个作业的输出，只要这些作业的 reducer 数量相同、键相同并且输出文件是不可切分的。

利用`org.apache.hadoop.mapreduce.join`包中的 CompositeInpuFormat 类来运行一个 map 端连接。

## 3.2reduce 端连接

由于 reduce 端连接并不要求输入数据集符合特定结构，因而 reduce 端连接比 map 端连接更为常用。但是，由于两个数据集均需经过 MapReduce 的 shuffle 过程，所以 reduce 端的连接效率往往要低一些。

# 4.边数据分布

“边数据”（side data）是作业所需要的额外的只读数据，以辅助处理主数据集。
