# 重大事件分析接口文档

## 0.相关说明

### searchFlag 说明

:::tips
searchFlag 说明：

`-1-自定义`

`1-半小时`

`2-1小时`

`3-3小时`

`4-1周`

`5-1月`

`6-半年`

`7-昨天`

`8-今天`

`9一年`

:::

### 响应码说明

```json
SUCCESS("成功", 0),
PARAM_ERROR("参数错误", 400),
NOT_LOGIN("请登录", 401),
NOT_AUTHORIZATION("未授权", 403),
NOT_FOUND("不存在相关信息", 404),
SYSTEM_ERROR("系统错误,请稍候再试~", 500),
COMMIT_FREQUENTLY("操作频繁,请稍候再试~", 601),
ACTION_FAIL("操作失败", 701)
```

## 1.查询事件类型

重大事件分析查询事件类型

:::tips

- **URL**：`/api/analysis/getEventTypes`
- **Method**：`GET`

:::

### 1.1请求参数

|参数|类型|描述|是否必传|
| :---------: | :----: | :------------------: | :------: |
|typeName|String|事件类型|N|
|searchFlag|String|参考 searchFlag 说明|Y|
|beginTime|String|开始时间|N|
|endTime|String|结束时间|N|
|description|String|对话/事件描述搜索词|N|

### 1.2请求示例

可以仅传递部分请求参数。

```plain
/api/analysis/getEventTypes?typeName=预警&searchFlag=1
```

### 1.3响应参数

:::tips
**条件**：请求参数合法。

**http状态码：**​`200 OK`

**响应示例**：如下

:::

```json
{
    "code": 0,
    "message": "成功",
    "data": {
        "total": 1,
        "eventTypes": [{
                "id": "9",
                "typeName": "咨询疫情防控政策"
            }
        ]
    }
}
```

**eventTypes 参数说明：**

|参数|类型|描述|是否必传|
| :------: | :-----: | :------: | :------: |
|id|Integer|类型 id|Y|
|typeName|String|类型名称|Y|

---

## 2.查询事件类型

查询事件类型下的告警规则

:::tips

- **URL**：`/api/analysis/rules`
- **Method**：`GET`

:::

### 2.1请求参数

|参数|类型|描述|是否必传|
| :---------: | :-----: | :------------------: | :------: |
|typeId|Integer|事件类型Id|Y|
|searchFlag|String|参考 searchFlag 说明|Y|
|beginTime|String|开始时间|N|
|endTime|String|结束时间|N|
|description|String|对话/事件描述搜索词|N|
|pageNum|Integer|页码|Y|
|pageSize|Integer|页大小|Y|

### 2.2请求示例

可以仅传递部分请求参数。

```plain
/api/analysis/rules?typeId=1&searchFlag=1&pageNum=1&pageSize=10
```

### 2.3响应参数

:::tips
**条件**：请求参数合法。

**http状态码：**​`200 OK`

**响应示例**：如下

:::

```json
{
    "status": true,
    "message": "success",
    "data": {
        "total": 10,
        "alarmList": {
            "total": 10,
            "list": [{
                    "ruleId": "111",
                    "typeId": "9",
                    "typeName": "咨询疫情防控政策",
                    "eventDesc": "市民来电咨询核酸检测相关问题",
                    "callDate": "2030-03-01 20:07:00",
                    "createTime": "2022-09-29 15:25:05",
                    "ruleName": "出入市政策",
                    "description": null,
                    "factorConditionList": [{
                            "id": 250,
                            "ruleId": 111,
                            "factorName": "触发词",
                            "factorType": "text",
                            "symbolId": 12,
                            "symbolName": null,
                            "factorValue": "核酸",
                            "startTime": null,
                            "endTime": null
                        }
                    ],
                    "dimension": ["触发词"],
                    "alarmNum": 1,
                    "alarmTime": "2030-03-01 20:07:00",
                    "area": "金山区朱泾镇温河村",
                    "timeList": ["2030-03-01 20:07:00"],
                    "advice": null
                }],
            "pageNum": 1,
            "pageSize": 9,
            "size": 9,
            "startRow": 0,
            "endRow": 8,
            "pages": 1,
            "prePage": 0,
            "nextPage": 0,
            "isFirstPage": true,
            "isLastPage": true,
            "hasPreviousPage": false,
            "hasNextPage": false,
            "navigatePages": 8,
            "navigatepageNums": [1],
            "navigateFirstPage": 1,
            "navigateLastPage": 1
        },
        "changeNum": 0
    }
}

```

**list 参数说明：**

|参数|类型|描述|是否必传|
| :-----------------: | :-----: | :----------: | :------: |
|ruleId|Integer|告警规则id|Y|
|typeName|String|事件名称|Y|
|eventDesc|String|事件描述|Y|
|callDate|String|通话事件|Y|
|ruleName|String|告警规则名称|Y|
|factorConditionList|List|告警详情|Y|
|dimension|List|维度名称集合|Y|
|alarmNum|Integer|告警次数|Y|

**factorConditionList 参数说明**

|参数|类型|描述|是否必传|
| -----------| ------| ------------------| --------|
|factorName|String|维度名称|Y|
|factorValue|String|纬度值（可能多个）|Y|

---

## 3.查询命中规则事件

查询事件类型下的告警规则

:::tips

- **URL**：`/api/analysis/rule/events`
- **Method**：`GET`

:::

### 3.1请求参数

|参数|类型|描述|是否必传|
| :-------: | :-----: | :--------: | :------: |
|ruleId|Integer|告警规则id|Y|
|eventDesc|String|事件描述|Y|
|beginTime|String|开始时间|N|
|endTime|String|结束时间|N|
|pageNum|Integer|页码|Y|
|pageSize|Integer|页大小|Y|

### 3.2请求示例

可以仅传递部分请求参数。

```plain
/api/analysis/rule/events?ruldId=1&eventDesc=市民&pageNum=1&pageSize=10
```

### 3.3响应参数

:::tips
**条件**：请求参数合法。

**http状态码：**​`200 OK`

**响应示例**：如下

:::

```json
{
    "status": true,
    "message": "success",
    "data": {
        "eventInfo": {
            "total": 168,
            "list": [{
                    "id": "99f447bb780a43ae8bf3038ea93a845a",
                    "callId": "3d7868ac9d97488aa3e9a1156b5e2c0f",
                    "typeId": "9",
                    "typeName": "咨询疫情防控政策",
                    "description": "【新型冠状病毒】市民反映：从4月初起，因为饭店关门，所以居委",
                    "dialogue": "来电人员因不给核酸来咨询疫情防控政策,咨询是否需要新型冠状病毒。",
                    "callDate": "2031-05-01 21:27:00",
                    "keywords": null,
                    "eventNum": null,
                    "applicationName": null,
                    "registerName": null,
                    "linkTel": null,
                    "caseAddress": null,
                    "reply": null,
                    "content": null
                }, {
                    "id": "23faf80ed60446e885d58d7e8af2235c",
                    "callId": "c4ace2d3a8b84a4ba07c9cbecf2b4310",
                    "typeId": "9",
                    "typeName": "咨询疫情防控政策",
                    "description": "【新型冠状病毒】市民反映：上述地址有肺癌免疫疾病患者未打疫苗",
                    "dialogue": "来电人员因上门核酸来咨询疫情防控政策,咨询是否需要新型冠状病毒。",
                    "callDate": "2031-03-01 23:15:00",
                    "keywords": null,
                    "eventNum": null,
                    "applicationName": null,
                    "registerName": null,
                    "linkTel": null,
                    "caseAddress": null,
                    "reply": null,
                    "content": null
                }, {
                    "id": "482e3024ec48480b95ca32a689329a3f",
                    "callId": "d49598ff0b264266b8612d16eaa09270",
                    "typeId": "9",
                    "typeName": "咨询疫情防控政策",
                    "description": "【新型冠状病毒】市民来电反映：金山区已经解封，该处从全区各地",
                    "dialogue": "来电人员因新型冠状病毒(让其做核酸)来咨询疫情防控政策",
                    "callDate": "2030-05-01 20:32:00",
                    "keywords": null,
                    "eventNum": null,
                    "applicationName": null,
                    "registerName": null,
                    "linkTel": null,
                    "caseAddress": null,
                    "reply": null,
                    "content": null
                }, {
                    "id": "81a275d3605f423680f61675c3f8fbc9",
                    "callId": "7d5e6ead35c4493d900265d98698c92c",
                    "typeId": "9",
                    "typeName": "咨询疫情防控政策",
                    "description": "【新型冠状病毒】市民来电反映：上述小区于3月30日在居委同意",
                    "dialogue": "来电人员因做核酸(只进不出)来咨询疫情防控政策",
                    "callDate": "2030-03-02 00:35:00",
                    "keywords": null,
                    "eventNum": null,
                    "applicationName": null,
                    "registerName": null,
                    "linkTel": null,
                    "caseAddress": null,
                    "reply": null,
                    "content": null
                }, {
                    "id": "573311486c474552919a7a55056a15d7",
                    "callId": "9b02be7d5a094bc7913faca02dd17d9b",
                    "typeId": "9",
                    "typeName": "咨询疫情防控政策",
                    "description": "【新型冠状病毒】市民反映：上海福申护理院领导不安排做核酸 ，",
                    "dialogue": "来电人员因不安排做核酸来咨询疫情防控政策",
                    "callDate": "2030-03-01 22:49:00",
                    "keywords": null,
                    "eventNum": null,
                    "applicationName": null,
                    "registerName": null,
                    "linkTel": null,
                    "caseAddress": null,
                    "reply": null,
                    "content": null
                }, {
                    "id": "5f61def00e924a76b7825e0502cd9890",
                    "callId": "2b7cfe7d4763452980f8cd01506c277a",
                    "typeId": "9",
                    "typeName": "咨询疫情防控政策",
                    "description": "【新型冠状病毒】市民来电反映：其住上述地址，金山出了通知，3",
                    "dialogue": "来电人员因不合理(优先做核酸)来咨询疫情防控政策",
                    "callDate": "2030-03-01 20:07:00",
                    "keywords": null,
                    "eventNum": null,
                    "applicationName": null,
                    "registerName": null,
                    "linkTel": null,
                    "caseAddress": null,
                    "reply": null,
                    "content": null
                }, {
                    "id": "fc367b56246c4e0aa2d1da80973c6143",
                    "callId": "f8f0d07b690d46f7873b3b3d11fddb64",
                    "typeId": "9",
                    "typeName": "咨询疫情防控政策",
                    "description": "【新型冠状病毒】市民来电反映：昨天1028号有3个确诊 1个",
                    "dialogue": "来电人员因发烧(未安排核酸)来咨询疫情防控政策",
                    "callDate": "2030-03-01 17:56:00",
                    "keywords": null,
                    "eventNum": null,
                    "applicationName": null,
                    "registerName": null,
                    "linkTel": null,
                    "caseAddress": null,
                    "reply": null,
                    "content": null
                }, {
                    "id": "f4bf1b0ba3aa486ea7951bcb9bb53df7",
                    "callId": "545f67d57d73475d988d732b8ede878a",
                    "typeId": "9",
                    "typeName": "咨询疫情防控政策",
                    "description": "【新型冠状病毒】市民来电反映：其和家中的2个老人是分开住的，",
                    "dialogue": "来电人员因做核酸(分开住、听力很不好)来咨询疫情防控政策",
                    "callDate": "2030-03-01 17:29:00",
                    "keywords": null,
                    "eventNum": null,
                    "applicationName": null,
                    "registerName": null,
                    "linkTel": null,
                    "caseAddress": null,
                    "reply": null,
                    "content": null
                }, {
                    "id": "2c20e085dd304eaa81f0aa4275bc25b1",
                    "callId": "edf056500ce6469288b73e75d8f5d55c",
                    "typeId": "9",
                    "typeName": "咨询疫情防控政策",
                    "description": "【新型冠状病毒】 【疫情防控专线分平台 纳税服务热线】隔离点",
                    "dialogue": "来电人员因拒绝闭环核酸来咨询疫情防控政策",
                    "callDate": "2029-05-01 23:36:00",
                    "keywords": null,
                    "eventNum": null,
                    "applicationName": null,
                    "registerName": null,
                    "linkTel": null,
                    "caseAddress": null,
                    "reply": null,
                    "content": null
                }, {
                    "id": "096d8e2ec3a74614a7139868aad4634d",
                    "callId": "6634646d9d054672b627ee4b58e8f02f",
                    "typeId": "9",
                    "typeName": "咨询疫情防控政策",
                    "description": "【新型冠状病毒】市民来电反映:上述楼道28号发生阳性，小区不",
                    "dialogue": "来电人员因不愿意上门做核酸检测(不认可、新型冠状病毒)来咨询疫情防控政策",
                    "callDate": "2029-04-01 21:36:00",
                    "keywords": null,
                    "eventNum": null,
                    "applicationName": null,
                    "registerName": null,
                    "linkTel": null,
                    "caseAddress": null,
                    "reply": null,
                    "content": null
                }
            ],
            "pageNum": 1,
            "pageSize": 10,
            "size": 10,
            "startRow": 1,
            "endRow": 10,
            "pages": 17,
            "prePage": 0,
            "nextPage": 2,
            "isFirstPage": true,
            "isLastPage": false,
            "hasPreviousPage": false,
            "hasNextPage": true,
            "navigatePages": 8,
            "navigatepageNums": [1, 2, 3, 4, 5, 6, 7, 8],
            "navigateFirstPage": 1,
            "navigateLastPage": 8
        },
        "keywords": ["复工", "没有", "封控", "骂人", "冤枉", "出差", "排队", "做了", "关门", "插队"]
    }
}

```

**list 参数说明：**

|参数|类型|描述|是否必传|
| :-----------------: | :-----: | :----------: | :------: |
|ruleId|Integer|告警规则id|Y|
|typeName|String|事件名称|Y|
|eventDesc|String|事件描述|Y|
|callDate|String|通话事件|Y|
|ruleName|String|告警规则名称|Y|
|factorConditionList|List|告警详情|Y|
|dimension|List|维度名称集合|Y|
|alarmNum|Integer|告警次数|Y|

**factorConditionList 参数说明**

|参数|类型|描述|是否必传|
| -----------| ------| ------------------| --------|
|factorName|String|维度名称|Y|
|factorValue|String|纬度值（可能多个）|Y|
